# EM Subscriptions Service

## Тестовое задание: спроектировать и реализовать REST-сервис для агрегации данных об онлайн-подписках пользователей.



Содержание:

  - [Запуск](#запуск)
  - [Документация API](#документация-api) 
  - [Настройки](#настройки)
  - [Структура проекта](#структура-проекта)
  - [Текст задания](#текст-задания)



## Запуск

Запуск через docker-compose:

```bash
make up
```

Запуск через docker-compose в фоновом режиме:

```bash
make upd
```

Остановка:

```bash
make down
```

Остановка с удалением томов:

```bash
make bye
```

Вывод логов:

```bash
make logs
```


Миграции накатываются автоматически через docker-compose.

Сервис доступен на http://localhost:8099:

| Метод  | Путь                        | Описание                      |
| ------ | --------------------------- | ----------------------------- |
| POST   | `/api/v1/subscription`      | Создание подписки             |
| GET    | `/api/v1/subscription/{id}` | Получение данных подписки     |
| PATCH  | `/api/v1/subscription/{id}` | Частичное обновление подписки |
| PUT    | `/api/v1/subscription/{id}` | Полное обновление подписки    |
| DELETE | `/api/v1/subscription/{id}` | Удаление подписки             |
| GET    | `/api/v1/subscription`      | Получение списка подписок     |
| GET    | `/api/v1/total`             | Суммарная стоимость подписок  |



## Документация API

Swagger UI поднимается в docker-compose и доступен по адресу: [http://localhost:8088/](http://localhost:8088/).<br>
Или OpenAPI файл: [/docs/openapi.yaml](docs/openapi.yaml)

## Настройки

Переменные окружения - файл .env

```
# Postgres:
EMSUB_DB_HOST=postgres # host
EMSUB_DB_PORT=5432 # port
EMSUB_DB_USER=admin # user 
EMSUB_DB_PASSWORD=password # password
EMSUB_DB_NAME=emsubscription # database name
EMSUB_DB_SSL=disable # SSL mode

# Service:
EMSUB_HTTP_PORT=8099 # port

#Swagger:
EMSUB_SWAG_PORT=8088 # port
```



Настройки - файл /config/config.yaml

```yaml
logbody: true # логировать ли тело запроса
limit: 50 # лимит возвращаемых записей за один запрос
```



## Структура проекта

- [cmd](cmd/) — главный пакет приложения (main.go, запуск сервера)
- [docs](docs/) — OpenAPI спецификация
- [internal](internal/)
  - [config](internal/config/) — конфигурация
  - [model](internal/model/) — модели 
  - [interfaces](internal/interfaces/) — интерфейсы
  - [db](internal/db/) — функции работы с БД
    - [migrations](internal/db/migrations) — миграции
  - [api](internal/api/) — реализация API и middleware
  - [utils](internal/utils/) — вспомогательные функции



## Текст задания

**Задача:** 

спроектировать и реализовать REST-сервис для агрегации данных об онлайн-подписках пользователей.

**Требования:**

1. Выставить HTTP-ручки для CRUDL-операций над записями о подписках. Каждая запись содержит:
    1. Название сервиса, предоставляющего подписку
    2. Стоимость месячной подписки в рублях
    3. ID пользователя в формате UUID
    4. Дата начала подписки (месяц и год)
    5. Опционально дата окончания подписки
2. Выставить HTTP-ручку для подсчета суммарной стоимости всех подписок за выбранный
    период с фильтрацией по id пользователя и названию подписки
3. СУБД – PostgreSQL. Должны быть миграции для инициализации базы данных
4. Покрыть код логами
5. Вынести конфигурационные данные в .env/.yaml-файл
6. Предоставить swagger-документацию к реализованному API
7. Запуск сервиса с помощью docker compose

**Примечания:**

1. Проверка существования пользователя не требуется. Управление пользователями вне зоны ответственности вашего сервиса
2. Стоимость любой подписки – целое число рублей, копейки не учитываются

Пример тела запроса на создание записи о подписке:

```json
{
  "service_name": "Yandex Plus",
  "price": 400,
  "user_id": "60601fee-2bf1-4721-ae6f-7636e79a0cba",
  "start_date": "07-2025"
}
```

